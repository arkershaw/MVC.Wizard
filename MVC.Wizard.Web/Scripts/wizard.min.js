(function(n){typeof define=="function"&&define.amd?define(["jquery","knockout","knockout-mapping","jquery-validate"],n):n(jQuery,ko,ko.mapping)})(function($,ko,n){ko.mapping===undefined&&(ko.mapping=n);ko.bindingHandlers.wizardStep={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){var stepIndex=ko.unwrap(valueAccessor()),model=bindingContext.$data.Model,step=eval("model."+model.StepNames()[stepIndex-1]),form;step.EnableClientValidation()||$(element).find(":input").attr("data-val","false");stepIndex===model.StepNames().length&&(form=$(element).closest("form"),form.removeData("validator"),form.removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse(form))},update:function(n,t,i,r,u){var f=ko.unwrap(t()),e=u.$data.Model;f===e.StepIndex()?$(n).show():$(n).hide()}};$.fn.Wizard=function(n){function i(t){var f=$("#"+n.formId),r=f.validate(),u,i;if(f.find(".field-validation-error span").each(function(){r.settings.success($(this))}),r.resetForm(),t&&t.length>0){for(u={},i=0;i<t.length;i++)t[i].MemberName!==""&&(u[t[i].MemberName]=t[i].Message);r.showErrors(u)}}var r=function(t,r){var self=this;self.Model=ko.mapping.fromJS(t,r);self.Model.GeneralErrors=ko.computed(function(){return ko.utils.arrayFilter(self.Model.Errors(),function(n){return!!n.MemberName})});self.Model.CurrentStep=ko.computed(function(){return eval("self.Model."+self.Model.StepNames()[self.Model.StepIndex()-1])});self.Model.TotalSteps=ko.computed(function(){return self.Model.StepNames().length});self.Model.Update=function(n){self.Update(n)};self.Next=function(){self.ValidateAndPost("NextWizardStep")};self.Previous=function(){self.PostForm("PreviousWizardStep")};self.Update=function(){self.UpdateOnChange?self.ValidateAndPost("UpdateWizardStep"):self.ValidateAndPost()};self.ValidateAndPost=function(t){var i=$("#"+n.formId),r=i.validate();i.valid()?t&&self.PostForm(t):r.focusInvalid()};self.PostForm=function(t){$.ajax({url:n.url+t,type:"POST",dataType:"json",contentType:"application/json",data:ko.toJSON(self.Model),success:function(n){self.UpdateOnChange=!1;ko.mapping.fromJS(n,self.Model);self.UpdateOnChange=!0;i(n.Errors)},error:function(){}})}},t=new r(n.model,n.mapping);return ko.applyBindings(t,this[0]),t.UpdateOnChange=!0,this}});
//# sourceMappingURL=wizard.min.js.map
