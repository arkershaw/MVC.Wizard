(function(n){typeof define=="function"&&define.amd?define(["jquery","knockout","knockout-mapping","jquery-validate"],n):n(jQuery,ko,ko.mapping)})(function($,ko,n){ko.mapping===undefined&&(ko.mapping=n);ko.bindingHandlers.wizardStep={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){var stepIndex=ko.unwrap(valueAccessor()),model=bindingContext.$data.Model,step=eval("model."+model.StepNames()[stepIndex-1]),form;step.EnableClientValidation()||$(element).find(":input").attr("data-val","false");stepIndex==model.StepNames().length&&(form=$(element).closest("form"),form.removeData("validator"),form.removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse(form))},update:function(n,t,i,r,u){var s=ko.unwrap(t()),o=u.$data.Model,f,e;s==o.StepIndex()?$(n).show():$(n).hide();o.CurrentStep().EnableClientValidation()||(f=$(n).closest("form"),e=f.validate(),f.find(".field-validation-error span").each(function(){e.settings.success($(this))}),e.resetForm())}};$.fn.Wizard=function(n){function t(t){var r,u,i;if(t){for(r=$("#"+n.formId).validate(),r.resetForm(),u={},i=0;i<t.length;i++)t[i].MemberName!==""&&(u[t[i].MemberName]=t[i].Message);r.showErrors(u)}}this.find(".wizard-errors-summary").append('<ul data-bind="foreach: Model.GeneralErrors, visible: Model.GeneralErrors().length > 0"><li data-bind="text: Message"><\/li><\/ul>');var i=function(i,r){var self=this;self.Model=ko.mapping.fromJS(i,r);self.Model.GeneralErrors=ko.computed(function(){return ko.utils.arrayFilter(self.Model.Errors(),function(n){return!!n.MemberName})});self.Model.CurrentStep=ko.computed(function(){return eval("self.Model."+self.Model.StepNames()[self.Model.StepIndex()-1])});self.Model.TotalSteps=ko.computed(function(){return self.Model.StepNames().length});self.Model.Update=function(n){self.Update(n)};self.Next=function(n){var t=$(n).closest("form").validate();$(n).closest("form").valid()?self.RoundTrip("NextWizardStep"):t.focusInvalid()};self.Previous=function(){self.RoundTrip("PreviousWizardStep")};self.Update=function(n){var t=$(n).closest("form").validate();$(n).closest("form").valid()||t.focusInvalid()};self.RoundTrip=function(i){$.ajax({url:n.url+i,type:"POST",dataType:"json",contentType:"application/json",data:ko.toJSON(self.Model),success:function(n){ko.mapping.fromJS(n,self.Model);t(n.Errors)},error:function(){}})}},r=new i(n.model,n.mapping);return ko.applyBindings(r,this[0]),this}});
//# sourceMappingURL=wizard.min.js.map
