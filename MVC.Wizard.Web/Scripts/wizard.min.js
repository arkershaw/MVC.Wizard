(function(n){typeof define=="function"&&define.amd?define(["jquery","knockout","knockout-mapping","jquery-validate"],n):n(jQuery,ko,ko.mapping)})(function(n,t,i){t.mapping===undefined&&(t.mapping=i);n.fn.Wizard=function(i){function o(n){n.validate().settings.ignore="*"}function s(n){n.validate().settings.ignore=":hidden"}function f(n){n?s(r):o(r)}function h(n){var i,u,t;if(n){for(i=r.validate(),i.resetForm(),u={},t=0;t<n.length;t++)n[t].MemberName!==""&&(u[n[t].MemberName]=n[t].Message);i.showErrors(u)}}var r,e,u;return this.find(".wizard-errors-summary").append('<ul data-bind="foreach: Model.GeneralErrors, visible: Model.GeneralErrors().length > 0"><li data-bind="text: Message"><\/li><\/ul>'),r=n("#"+i.formId),e=function(r,u){var self=this;self.Model=t.mapping.fromJS(r,u);self.Model.GeneralErrors=t.computed(function(){return t.utils.arrayFilter(self.Model.Errors(),function(n){return!!n.MemberName})});self.Model.CurrentStep=t.computed(function(){return eval("self.Model.Step"+self.Model.StepIndex())});self.Model.Update=function(n){self.Update(n)};self.Next=function(t){var i=n(t).closest("form").validate();n(t).closest("form").valid()?self.RoundTrip("NextWizardStep"):i.focusInvalid()};self.Previous=function(){self.RoundTrip("PreviousWizardStep")};self.Update=function(t){var i=n(t).closest("form").validate();n(t).closest("form").valid()?self.UpdateOnChange&&self.RoundTrip("UpdateWizardStep"):i.focusInvalid()};self.RoundTrip=function(r){n.ajax({url:i.url+r,type:"POST",dataType:"json",contentType:"application/json",data:t.toJSON(self.Model),success:function(n){self.UpdateOnChange=!1;t.mapping.fromJS(n,self.Model);self.UpdateOnChange=!0;h(n.Errors);f(self.Model.CurrentStep().EnableClientValidation())},error:function(){}})};self.MemberHasErrors=function(n){return!!self.FirstErrorForMember(n)};self.FirstErrorForMember=function(n){if(self.Model.Errors()){var i=t.utils.arrayFirst(self.Model.Errors(),function(t){return t.MemberName()==n});return i?i.Message():null}}},u=new e(i.model,i.mapping),t.applyBindings(u,this[0]),u.UpdateOnChange=!0,f(u.Model.CurrentStep().EnableClientValidation()),this}});
//# sourceMappingURL=wizard.min.js.map
